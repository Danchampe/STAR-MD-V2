<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaFlow - Music Streaming</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        .album-art {
            background: linear-gradient(45deg, #1e40af, #7c3aed, #ec4899);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            width: 30%;
            border-radius: 2px;
        }
        
        .glass-effect {
            background: rgba(17, 24, 39, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .now-playing-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 90px;
            z-index: 100;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .page-transition {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .page-hidden {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
        }
        
        .page-active {
            transform: translateX(0);
            opacity: 1;
        }
        
        .track-hover:hover {
            background-color: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        
        .play-button {
            transition: all 0.2s ease;
        }
        
        .play-button:hover {
            transform: scale(1.05);
        }
        
        .play-button:active {
            transform: scale(0.95);
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-black text-white">
    
    <!-- Main App Container -->
    <div class="flex flex-col h-screen">
        
        <!-- Top Navigation -->
        <nav class="flex items-center justify-between p-4 glass-effect">
            <div class="flex items-center space-x-4">
                <button id="menuToggle" class="p-2 hover:bg-gray-800 rounded-lg">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                    MediaFlow
                </h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <button class="p-2 hover:bg-gray-800 rounded-lg">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="p-2 hover:bg-gray-800 rounded-lg">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </nav>
        
        <!-- Sidebar (Hidden by default on mobile) -->
        <div id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-gray-900 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
            <div class="p-4">
                <div class="mb-8">
                    <button class="w-full flex items-center space-x-3 p-3 hover:bg-gray-800 rounded-lg mb-2 active-page" data-page="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 p-3 hover:bg-gray-800 rounded-lg mb-2" data-page="search">
                        <i class="fas fa-search"></i>
                        <span>Search</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 p-3 hover:bg-gray-800 rounded-lg mb-2" data-page="library">
                        <i class="fas fa-music"></i>
                        <span>Your Library</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 p-3 hover:bg-gray-800 rounded-lg mb-2" data-page="playlist">
                        <i class="fas fa-list"></i>
                        <span>Playlists</span>
                    </button>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-gray-400 text-sm font-semibold mb-3">RECENTLY PLAYED</h3>
                    <div id="recentTracks" class="space-y-2">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
                
                <div>
                    <h3 class="text-gray-400 text-sm font-semibold mb-3">PLAYLISTS</h3>
                    <div class="space-y-2">
                        <button class="w-full flex items-center space-x-3 p-2 hover:bg-gray-800 rounded text-left">
                            <i class="fas fa-heart text-red-500"></i>
                            <span>Liked Songs</span>
                        </button>
                        <button class="w-full flex items-center space-x-3 p-2 hover:bg-gray-800 rounded text-left">
                            <i class="fas fa-fire text-orange-500"></i>
                            <span>Top Hits 2024</span>
                        </button>
                        <button class="w-full flex items-center space-x-3 p-2 hover:bg-gray-800 rounded text-left">
                            <i class="fas fa-moon text-yellow-500"></i>
                            <span>Chill Vibes</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Overlay for mobile sidebar -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
        
        <!-- Main Content Area -->
        <main class="flex-1 overflow-auto md:ml-64">
            
            <!-- Home Page -->
            <div id="homePage" class="page-active page-transition p-6">
                <h2 class="text-3xl font-bold mb-6">Good morning</h2>
                
                <!-- Quick Access -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-900 rounded-lg p-4 flex items-center space-x-4 hover:bg-gray-800 cursor-pointer">
                        <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-blue-500 rounded-lg"></div>
                        <span class="font-medium">Daily Mix 1</span>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 flex items-center space-x-4 hover:bg-gray-800 cursor-pointer">
                        <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg"></div>
                        <span class="font-medium">Discover Weekly</span>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 flex items-center space-x-4 hover:bg-gray-800 cursor-pointer">
                        <div class="w-14 h-14 bg-gradient-to-br from-yellow-500 to-red-500 rounded-lg"></div>
                        <span class="font-medium">Release Radar</span>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 flex items-center space-x-4 hover:bg-gray-800 cursor-pointer">
                        <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg"></div>
                        <span class="font-medium">Chill Vibes</span>
                    </div>
                </div>
                
                <!-- Recommended Tracks -->
                <h3 class="text-2xl font-bold mb-4">Made for You</h3>
                <div id="trackList" class="space-y-2">
                    <!-- Tracks will be loaded here -->
                </div>
            </div>
            
            <!-- Search Page -->
            <div id="searchPage" class="page-hidden page-transition p-6">
                <div class="mb-6">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" 
                               id="searchInput"
                               placeholder="Search for songs, artists, or albums" 
                               class="w-full bg-gray-900 text-white pl-12 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <h3 class="text-2xl font-bold mb-4">Browse All</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">Podcasts</span>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-indigo-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">New Releases</span>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-rose-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">Hip Hop</span>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">Pop</span>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-500 to-amber-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">Rock</span>
                    </div>
                    <div class="bg-gradient-to-br from-pink-500 to-rose-700 rounded-lg p-4 aspect-square flex items-end cursor-pointer hover:opacity-90">
                        <span class="font-bold text-lg">Dance/Electronic</span>
                    </div>
                </div>
            </div>
            
            <!-- Library Page -->
            <div id="libraryPage" class="page-hidden page-transition p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-bold">Your Library</h2>
                    <div class="flex space-x-2">
                        <button class="p-2 hover:bg-gray-800 rounded-lg">
                            <i class="fas fa-sort"></i>
                        </button>
                        <button class="p-2 hover:bg-gray-800 rounded-lg">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg hover:bg-gray-800 cursor-pointer">
                        <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-pink-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-heart text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg">Liked Songs</h4>
                            <p class="text-gray-400">Playlist • 124 songs</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg hover:bg-gray-800 cursor-pointer">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-list-music text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg">My Playlist #1</h4>
                            <p class="text-gray-400">Playlist • 42 songs</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 p-4 bg-gray-900 rounded-lg hover:bg-gray-800 cursor-pointer">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-record-vinyl text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg">Saved Albums</h4>
                            <p class="text-gray-400">Album • 18 albums</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Playlist Page -->
            <div id="playlistPage" class="page-hidden page-transition p-6">
                <div class="mb-8">
                    <div class="flex flex-col md:flex-row items-start md:items-end space-y-4 md:space-y-0 md:space-x-6">
                        <div class="w-48 h-48 bg-gradient-to-br from-green-500 via-blue-500 to-purple-500 rounded-lg shadow-lg"></div>
                        <div>
                            <p class="text-sm font-semibold mb-2">PLAYLIST</p>
                            <h2 class="text-5xl font-bold mb-4">Discover Weekly</h2>
                            <p class="text-gray-300 mb-2">Your weekly mixtape of fresh music. Enjoy new discoveries and deep cuts chosen just for you.</p>
                            <p class="text-gray-400">Spotify • 30 songs, about 1 hr 45 min</p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <!-- Playlist tracks will be loaded here -->
                </div>
            </div>
            
            <!-- Player Page (Full Screen Player) -->
            <div id="playerPage" class="page-hidden page-transition fixed inset-0 bg-gradient-to-b from-gray-900 to-black z-50">
                <div class="p-6 h-full flex flex-col">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-8">
                        <button id="closePlayer" class="p-3 hover:bg-gray-800 rounded-full">
                            <i class="fas fa-chevron-down text-xl"></i>
                        </button>
                        <div class="text-center">
                            <p class="text-gray-400 text-sm">PLAYING FROM PLAYLIST</p>
                            <p class="font-semibold">Discover Weekly</p>
                        </div>
                        <button class="p-3 hover:bg-gray-800 rounded-full">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                    
                    <!-- Album Art -->
                    <div class="flex-1 flex flex-col items-center justify-center">
                        <div id="currentAlbumArt" class="w-72 h-72 md:w-96 md:h-96 album-art rounded-2xl shadow-2xl mb-8"></div>
                        
                        <!-- Track Info -->
                        <div class="text-center mb-8">
                            <h2 id="currentTrackTitle" class="text-3xl md:text-4xl font-bold mb-2">No track selected</h2>
                            <p id="currentTrackArtist" class="text-xl text-gray-300">Select a song to play</p>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full max-w-2xl mb-2">
                            <div class="progress-bar mb-2">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                            <div class="flex justify-between text-sm text-gray-400">
                                <span id="currentTime">0:00</span>
                                <span id="totalTime">0:00</span>
                            </div>
                        </div>
                        
                        <!-- Player Controls -->
                        <div class="flex items-center justify-center space-x-8 mt-8">
                            <button class="p-4 hover:bg-gray-800 rounded-full">
                                <i class="fas fa-random text-xl text-gray-400"></i>
                            </button>
                            <button id="prevButton" class="p-4 hover:bg-gray-800 rounded-full">
                                <i class="fas fa-step-backward text-2xl"></i>
                            </button>
                            <button id="playPauseButton" class="p-5 bg-white text-black rounded-full play-button">
                                <i id="playPauseIcon" class="fas fa-play text-2xl"></i>
                            </button>
                            <button id="nextButton" class="p-4 hover:bg-gray-800 rounded-full">
                                <i class="fas fa-step-forward text-2xl"></i>
                            </button>
                            <button class="p-4 hover:bg-gray-800 rounded-full">
                                <i class="fas fa-redo text-xl text-gray-400"></i>
                            </button>
                        </div>
                        
                        <!-- Volume Control -->
                        <div class="flex items-center space-x-4 mt-8 w-full max-w-md">
                            <i class="fas fa-volume-down text-gray-400"></i>
                            <div class="flex-1 h-1 bg-gray-700 rounded-full overflow-hidden">
                                <div id="volumeFill" class="h-full bg-white w-3/4"></div>
                            </div>
                            <i class="fas fa-volume-up text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Now Playing Bar (Always visible) -->
        <div id="nowPlayingBar" class="now-playing-bar glass-effect flex items-center justify-between px-4">
            <!-- Track Info -->
            <div class="flex items-center space-x-4 w-1/4">
                <div id="miniAlbumArt" class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-500 rounded"></div>
                <div>
                    <h4 id="miniTrackTitle" class="font-semibold truncate">Not playing</h4>
                    <p id="miniTrackArtist" class="text-sm text-gray-400 truncate">Select a track</p>
                </div>
                <button class="p-1 hover:bg-gray-800 rounded">
                    <i class="fas fa-heart text-gray-400"></i>
                </button>
            </div>
            
            <!-- Player Controls -->
            <div class="flex flex-col items-center flex-1 max-w-md">
                <div class="flex items-center space-x-6">
                    <button class="p-2 hover:bg-gray-800 rounded-full">
                        <i class="fas fa-random text-sm text-gray-400"></i>
                    </button>
                    <button id="miniPrevButton" class="p-2 hover:bg-gray-800 rounded-full">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button id="miniPlayPauseButton" class="p-3 bg-white text-black rounded-full play-button">
                        <i id="miniPlayPauseIcon" class="fas fa-play"></i>
                    </button>
                    <button id="miniNextButton" class="p-2 hover:bg-gray-800 rounded-full">
                        <i class="fas fa-step-forward"></i>
                    </button>
                    <button class="p-2 hover:bg-gray-800 rounded-full">
                        <i class="fas fa-redo text-sm text-gray-400"></i>
                    </button>
                </div>
                <div class="flex items-center space-x-2 w-full mt-2">
                    <span class="text-xs text-gray-400">0:00</span>
                    <div class="flex-1 h-1 bg-gray-700 rounded-full overflow-hidden">
                        <div id="miniProgressFill" class="h-full bg-white w-0"></div>
                    </div>
                    <span class="text-xs text-gray-400">0:00</span>
                </div>
            </div>
            
            <!-- Right Controls -->
            <div class="flex items-center space-x-4 w-1/4 justify-end">
                <button class="p-2 hover:bg-gray-800 rounded">
                    <i class="fas fa-list-music"></i>
                </button>
                <button class="p-2 hover:bg-gray-800 rounded">
                    <i class="fas fa-volume-up"></i>
                </button>
                <div class="w-24 h-1 bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-white w-3/4"></div>
                </div>
                <button id="expandPlayer" class="p-2 hover:bg-gray-800 rounded">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Application -->
    <script>
        // Application State
        const MediaFlow = {
            // Music Library
            tracks: [
                {
                    id: 1,
                    title: "Blinding Lights",
                    artist: "The Weeknd",
                    album: "After Hours",
                    duration: "3:22",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                    color: "from-red-500 to-orange-500"
                },
                {
                    id: 2,
                    title: "Shape of You",
                    artist: "Ed Sheeran",
                    album: "÷ (Divide)",
                    duration: "3:54",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                    color: "from-green-500 to-emerald-500"
                },
                {
                    id: 3,
                    title: "Stay",
                    artist: "The Kid LAROI, Justin Bieber",
                    album: "F*CK LOVE 3",
                    duration: "2:23",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                    color: "from-blue-500 to-cyan-500"
                },
                {
                    id: 4,
                    title: "Bad Guy",
                    artist: "Billie Eilish",
                    album: "When We All Fall Asleep",
                    duration: "3:14",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
                    color: "from-purple-500 to-pink-500"
                },
                {
                    id: 5,
                    title: "Dynamite",
                    artist: "BTS",
                    album: "Dynamite (Single)",
                    duration: "3:19",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",
                    color: "from-yellow-500 to-orange-500"
                },
                {
                    id: 6,
                    title: "Levitating",
                    artist: "Dua Lipa",
                    album: "Future Nostalgia",
                    duration: "3:24",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3",
                    color: "from-pink-500 to-rose-500"
                },
                {
                    id: 7,
                    title: "Save Your Tears",
                    artist: "The Weeknd",
                    album: "After Hours",
                    duration: "3:35",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3",
                    color: "from-indigo-500 to-blue-500"
                },
                {
                    id: 8,
                    title: "Good 4 U",
                    artist: "Olivia Rodrigo",
                    album: "SOUR",
                    duration: "2:58",
                    uri: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3",
                    color: "from-red-500 to-purple-500"
                }
            ],
            
            // Player State
            player: {
                currentTrack: null,
                isPlaying: false,
                currentTime: 0,
                duration: 0,
                volume: 0.75,
                queue: [],
                history: []
            },
            
            // Audio Element
            audio: null,
            
            // UI Elements
            elements: {},
            
            // Initialize the app
            init() {
                this.audio = new Audio();
                this.audio.volume = this.player.volume;
                
                this.cacheElements();
                this.bindEvents();
                this.renderTracks();
                this.updateNowPlaying();
                
                // Set audio event listeners
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('loadedmetadata', () => {
                    this.player.duration = this.audio.duration;
                    this.updateTotalTime();
                });
                this.audio.addEventListener('ended', () => this.playNext());
                
                // Initialize queue with all tracks
                this.player.queue = [...this.tracks];
                
                console.log("MediaFlow initialized successfully!");
            },
            
            // Cache DOM elements
            cacheElements() {
                this.elements = {
                    // Pages
                    homePage: document.getElementById('homePage'),
                    searchPage: document.getElementById('searchPage'),
                    libraryPage: document.getElementById('libraryPage'),
                    playlistPage: document.getElementById('playlistPage'),
                    playerPage: document.getElementById('playerPage'),
                    
                    // Navigation
                    sidebar: document.getElementById('sidebar'),
                    sidebarOverlay: document.getElementById('sidebarOverlay'),
                    menuToggle: document.getElementById('menuToggle'),
                    navButtons: document.querySelectorAll('[data-page]'),
                    
                    // Player
                    playPauseButton: document.getElementById('playPauseButton'),
                    playPauseIcon: document.getElementById('playPauseIcon'),
                    miniPlayPauseButton: document.getElementById('miniPlayPauseButton'),
                    miniPlayPauseIcon: document.getElementById('miniPlayPauseIcon'),
                    prevButton: document.getElementById('prevButton'),
                    nextButton: document.getElementById('nextButton'),
                    miniPrevButton: document.getElementById('miniPrevButton'),
                    miniNextButton: document.getElementById('miniNextButton'),
                    closePlayer: document.getElementById('closePlayer'),
                    expandPlayer: document.getElementById('expandPlayer'),
                    
                    // Track info
                    currentTrackTitle: document.getElementById('currentTrackTitle'),
                    currentTrackArtist: document.getElementById('currentTrackArtist'),
                    currentAlbumArt: document.getElementById('currentAlbumArt'),
                    miniTrackTitle: document.getElementById('miniTrackTitle'),
                    miniTrackArtist: document.getElementById('miniTrackArtist'),
                    miniAlbumArt: document.getElementById('miniAlbumArt'),
                    
                    // Progress
                    progressFill: document.getElementById('progressFill'),
                    miniProgressFill: document.getElementById('miniProgressFill'),
                    currentTime: document.getElementById('currentTime'),
                    totalTime: document.getElementById('totalTime'),
                    
                    // Track list
                    trackList: document.getElementById('trackList'),
                    recentTracks: document.getElementById('recentTracks'),
                    
                    // Search
                    searchInput: document.getElementById('searchInput')
                };
            },
            
            // Bind event listeners
            bindEvents() {
                // Navigation
                this.elements.menuToggle.addEventListener('click', () => this.toggleSidebar());
                this.elements.sidebarOverlay.addEventListener('click', () => this.toggleSidebar());
                
                this.elements.navButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const page = e.currentTarget.getAttribute('data-page');
                        this.navigateTo(page);
                        this.toggleSidebar(false);
                    });
                });
                
                // Player controls
                this.elements.playPauseButton.addEventListener('click', () => this.togglePlay());
                this.elements.miniPlayPauseButton.addEventListener('click', () => this.togglePlay());
                this.elements.prevButton.addEventListener('click', () => this.playPrevious());
                this.elements.nextButton.addEventListener('click', () => this.playNext());
                this.elements.miniPrevButton.addEventListener('click', () => this.playPrevious());
                this.elements.miniNextButton.addEventListener('click', () => this.playNext());
                this.elements.closePlayer.addEventListener('click', () => this.closeFullPlayer());
                this.elements.expandPlayer.addEventListener('click', () => this.openFullPlayer());
                
                // Search
                this.elements.searchInput.addEventListener('input', (e) => this.searchTracks(e.target.value));
            },
            
            // Navigation
            navigateTo(page) {
                // Hide all pages
                const pages = ['homePage', 'searchPage', 'libraryPage', 'playlistPage', 'playerPage'];
                pages.forEach(pageId => {
                    const element = this.elements[pageId];
                    if (element) {
                        element.classList.add('page-hidden');
                        element.classList.remove('page-active');
                    }
                });
                
                // Show selected page
                const targetPage = this.elements[`${page}Page`];
                if (targetPage) {
                    targetPage.classList.remove('page-hidden');
                    targetPage.classList.add('page-active');
                }
                
                // Update active nav button
                this.elements.navButtons.forEach(button => {
                    if (button.getAttribute('data-page') === page) {
                        button.classList.add('active-page', 'bg-gray-800');
                    } else {
                        button.classList.remove('active-page', 'bg-gray-800');
                    }
                });
            },
            
            toggleSidebar(force) {
                if (force !== undefined) {
                    this.elements.sidebar.classList.toggle('-translate-x-full', !force);
                    this.elements.sidebarOverlay.classList.toggle('hidden', !force);
                } else {
                    this.elements.sidebar.classList.toggle('-translate-x-full');
                    this.elements.sidebarOverlay.classList.toggle('hidden');
                }
            },
            
            // Player functionality
            playTrack(track) {
                if (!track || !track.uri) return;
                
                // Add current track to history
                if (this.player.currentTrack) {
                    this.player.history.push(this.player.currentTrack);
                }
                
                this.player.currentTrack = track;
                this.player.isPlaying = true;
                this.audio.src = track.uri;
                
                this.audio.play().then(() => {
                    this.updateNowPlaying();
                    this.updatePlayPauseButtons();
                    this.renderRecentTracks();
                }).catch(error => {
                    console.error("Error playing track:", error);
                    this.player.isPlaying = false;
                    this.updatePlayPauseButtons();
                });
            },
            
            togglePlay() {
                if (!this.player.currentTrack) {
                    // If no track is selected, play the first track
                    this.playTrack(this.tracks[0]);
                    return;
                }
                
                if (this.player.isPlaying) {
                    this.audio.pause();
                    this.player.isPlaying = false;
                } else {
                    this.audio.play();
                    this.player.isPlaying = true;
                }
                
                this.updatePlayPauseButtons();
            },
            
            playNext() {
                if (this.player.queue.length === 0) return;
                
                const currentIndex = this.player.queue.findIndex(
                    track => track.id === this.player.currentTrack?.id
                );
                
                let nextIndex = (currentIndex + 1) % this.player.queue.length;
                if (currentIndex === -1) nextIndex = 0;
                
                this.playTrack(this.player.queue[nextIndex]);
            },
            
            playPrevious() {
                if (this.player.history.length === 0) return;
                
                const previousTrack = this.player.history.pop();
                this.playTrack(previousTrack);
            },
            
            updateNowPlaying() {
                const track = this.player.currentTrack;
                
                if (track) {
                    // Update full player
                    this.elements.currentTrackTitle.textContent = track.title;
                    this.elements.currentTrackArtist.textContent = track.artist;
                    this.elements.currentAlbumArt.className = `w-72 h-72 md:w-96 md:h-96 album-art rounded-2xl shadow-2xl mb-8 ${track.color}`;
                    
                    // Update mini player
                    this.elements.miniTrackTitle.textContent = track.title;
                    this.elements.miniTrackArtist.textContent = track.artist;
                    this.elements.miniAlbumArt.className = `w-14 h-14 rounded ${track.color}`;
                } else {
                    this.elements.currentTrackTitle.textContent = "No track selected";
                    this.elements.currentTrackArtist.textContent = "Select a song to play";
                    this.elements.miniTrackTitle.textContent = "Not playing";
                    this.elements.miniTrackArtist.textContent = "Select a track";
                }
                
                this.updateTotalTime();
            },
            
            updatePlayPauseButtons() {
                const icon = this.player.isPlaying ? 'fa-pause' : 'fa-play';
                this.elements.playPauseIcon.className = `fas ${icon} text-2xl`;
                this.elements.miniPlayPauseIcon.className = `fas ${icon}`;
            },
            
            updateProgress() {
                if (!this.audio.duration) return;
                
                const progress = (this.audio.currentTime / this.audio.duration) * 100;
                this.elements.progressFill.style.width = `${progress}%`;
                this.elements.miniProgressFill.style.width = `${progress}%`;
                
                // Update current time display
                this.elements.currentTime.textContent = this.formatTime(this.audio.currentTime);
            },
            
            updateTotalTime() {
                if (this.audio.duration) {
                    this.elements.totalTime.textContent = this.formatTime(this.audio.duration);
                } else if (this.player.currentTrack?.duration) {
                    this.elements.totalTime.textContent = this.player.currentTrack.duration;
                }
            },
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            },
            
            openFullPlayer() {
                this.navigateTo('player');
            },
            
            closeFullPlayer() {
                this.navigateTo('home');
            },
            
            // Track rendering
            renderTracks() {
                if (!this.elements.trackList) return;
                
                this.elements.trackList.innerHTML = '';
                
                this.tracks.forEach(track => {
                    const trackElement = this.createTrackElement(track);
                    this.elements.trackList.appendChild(trackElement);
                });
            },
            
            renderRecentTracks() {
                if (!this.elements.recentTracks) return;
                
                // Get last 5 unique tracks from history + current
                const recent = [...this.player.history.slice(-4), this.player.currentTrack]
                    .filter((track, index, self) => 
                        track && self.findIndex(t => t?.id === track.id) === index
                    )
                    .slice(-5);
                
                this.elements.recentTracks.innerHTML = '';
                
                recent.forEach(track => {
                    if (!track) return;
                    
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-3 p-2 hover:bg-gray-800 rounded-lg cursor-pointer';
                    div.addEventListener('click', () => this.playTrack(track));
                    
                    div.innerHTML = `
                        <div class="w-10 h-10 rounded ${track.color}"></div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium truncate">${track.title}</p>
                            <p class="text-sm text-gray-400 truncate">${track.artist}</p>
                        </div>
                    `;
                    
                    this.elements.recentTracks.appendChild(div);
                });
            },
            
            createTrackElement(track) {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-900 rounded-lg track-hover cursor-pointer';
                div.addEventListener('click', () => this.playTrack(track));
                
                div.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 rounded ${track.color} flex items-center justify-center">
                            <i class="fas fa-music"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">${track.title}</h4>
                            <p class="text-gray-400">${track.artist} • ${track.album}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-400">${track.duration}</span>
                        <button class="p-2 hover:bg-gray-800 rounded-full">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                `;
                
                return div;
            },
            
            // Search functionality
            searchTracks(query) {
                if (!query.trim()) {
                    this.renderTracks();
                    return;
                }
                
                const filtered = this.tracks.filter(track => 
                    track.title.toLowerCase().includes(query.toLowerCase()) ||
                    track.artist.toLowerCase().includes(query.toLowerCase()) ||
                    track.album.toLowerCase().includes(query.toLowerCase())
                );
                
                if (!this.elements.trackList) return;
                
                this.elements.trackList.innerHTML = '';
                
                if (filtered.length === 0) {
                    this.elements.trackList.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-search text-4xl text-gray-500 mb-4"></i>
                            <p class="text-gray-400">No results found for "${query}"</p>
                        </div>
                    `;
                    return;
                }
                
                filtered.forEach(track => {
                    const trackElement = this.createTrackElement(track);
                    this.elements.trackList.appendChild(trackElement);
                });
            }
        };
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            MediaFlow.init();
        });
    </script>
</body>
</html>